{% extends "base.html" %}

{% block title %}Lecturer Dashboard - QUIZZO{% endblock %}

{% block body %}
<!-- Modern Lecturer Dashboard -->
<div class="min-h-screen bg-gradient-to-br from-primary-50 via-white to-accent-50">
    
    <!-- Top Navigation with 3D Glass Effect -->
    <nav class="nav-3d border-b border-white/20 sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-18">
                <!-- Logo & Brand with 3D Effect -->
                <div class="flex items-center space-x-4">
                    <div class="icon-3d icon-primary">
                        <i class="fas fa-chalkboard-teacher text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold gradient-text font-display">QUIZZO</h1>
                        <p class="text-xs text-secondary-500">Lecturer Portal</p>
                    </div>
                </div>
                
                <!-- Navigation Links with 3D Effects -->
                <div class="hidden md:flex items-center space-x-6">
                    <a href="{{ url_for('dashboard') }}" class="nav-link active glass-morphism">
                        <i class="fas fa-home mr-2 text-lg"></i>Dashboard
                    </a>
                    <a href="{{ url_for('study_materials') }}" class="nav-link glass-morphism">
                        <i class="fas fa-book mr-2 text-lg"></i>Study Materials
                    </a>
                    <a href="{{ url_for('courses') }}" class="nav-link glass-morphism">
                        <i class="fas fa-graduation-cap mr-2 text-lg"></i>Courses
                    </a>
                    <a href="{{ url_for('ai_course_generator') }}" class="nav-link glass-morphism">
                        <i class="fas fa-robot mr-2 text-lg"></i>AI Course Generator
                    </a>
                    <a href="{{ url_for('create_exam') }}" class="nav-link glass-morphism">
                        <i class="fas fa-plus-circle mr-2 text-lg"></i>Create Exam
                    </a>
                    <a href="{{ url_for('manage_exams') }}" class="nav-link glass-morphism">
                        <i class="fas fa-clipboard-list mr-2 text-lg"></i>Manage Exams
                    </a>
                    <a href="{{ url_for('exam_results_list') }}" class="nav-link glass-morphism">
                        <i class="fas fa-chart-bar mr-2 text-lg"></i>Results
                    </a>
                </div>
                
                <!-- User Menu -->
                <div class="flex items-center space-x-4">
                    <!-- Notifications -->
                    <div class="relative">
                        <button class="p-2 text-secondary-500 hover:text-primary-500 hover:bg-primary-50 rounded-lg transition-all" onclick="toggleNotifications()">
                            <i class="fas fa-bell text-lg"></i>
                            <span id="notification-badge" class="absolute -top-1 -right-1 w-3 h-3 bg-danger-500 rounded-full animate-pulse"></span>
                        </button>
                        
                        <!-- Notifications Dropdown -->
                        <div id="notifications-dropdown" class="hidden absolute right-0 top-12 w-80 bg-white rounded-xl shadow-xl border border-gray-200 z-50 max-h-96 overflow-y-auto">
                            <div class="p-4 border-b border-gray-200">
                                <div class="flex items-center justify-between">
                                    <h3 class="text-lg font-semibold text-gray-900">Notifications</h3>
                                    <button onclick="markAllAsRead()" class="text-sm text-blue-600 hover:text-blue-700">Mark all read</button>
                                </div>
                            </div>
                            
                            <div class="max-h-80 overflow-y-auto">
                                <!-- AI Course Generation Notifications -->
                                <div class="notification-item p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer" onclick="markAsRead(this)">
                                    <div class="flex items-start space-x-3">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                                <i class="fas fa-robot text-blue-600 text-sm"></i>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">AI Course Generator Ready</p>
                                            <p class="text-xs text-gray-600">Create comprehensive courses with AI assistance like GeeksforGeeks</p>
                                            <p class="text-xs text-gray-400 mt-1">2 minutes ago</p>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Exam Activity Notifications -->
                                <div class="notification-item p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer" onclick="markAsRead(this)">
                                    <div class="flex items-start space-x-3">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                                <i class="fas fa-clipboard-check text-green-600 text-sm"></i>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">New Exam Completed</p>
                                            <p class="text-xs text-gray-600">3 students completed your latest exam</p>
                                            <p class="text-xs text-gray-400 mt-1">1 hour ago</p>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Student Activity -->
                                <div class="notification-item p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer" onclick="markAsRead(this)">
                                    <div class="flex items-start space-x-3">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                                                <i class="fas fa-graduation-cap text-purple-600 text-sm"></i>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">Course Enrollment</p>
                                            <p class="text-xs text-gray-600">5 new students enrolled in your courses</p>
                                            <p class="text-xs text-gray-400 mt-1">3 hours ago</p>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- System Updates -->
                                <div class="notification-item p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer" onclick="markAsRead(this)">
                                    <div class="flex items-start space-x-3">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center">
                                                <i class="fas fa-cog text-orange-600 text-sm"></i>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">Platform Update</p>
                                            <p class="text-xs text-gray-600">New features added: AI-powered question generation and virtual classrooms</p>
                                            <p class="text-xs text-gray-400 mt-1">1 day ago</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Performance Insights -->
                                <div class="notification-item p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer" onclick="markAsRead(this)">
                                    <div class="flex items-start space-x-3">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center">
                                                <i class="fas fa-chart-line text-yellow-600 text-sm"></i>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">Weekly Report Ready</p>
                                            <p class="text-xs text-gray-600">Your teaching analytics and student performance report is available</p>
                                            <p class="text-xs text-gray-400 mt-1">2 days ago</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="p-4 border-t border-gray-200">
                                <a href="#" class="block w-full text-center text-sm text-blue-600 hover:text-blue-700 font-medium">
                                    View All Notifications
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Profile -->
                    <div class="flex items-center space-x-3">
                        <div class="relative">
                            <div class="w-10 h-10 bg-gradient-to-r from-primary-400 to-accent-400 rounded-full flex items-center justify-center">
                                <span class="text-white font-semibold text-sm">{{ user.username[0].upper() }}</span>
                            </div>
                            <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-success-500 rounded-full border-2 border-white"></div>
                        </div>
                        <div class="hidden md:block">
                            <p class="font-semibold text-secondary-900">{{ user.username }}</p>
                            <p class="text-xs text-secondary-500">Lecturer</p>
                        </div>
                        
                        <!-- Dropdown Menu -->
                        <div class="relative">
                            <button class="p-1 text-secondary-500 hover:text-primary-500" onclick="toggleUserMenu()">
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <div id="user-menu" class="hidden absolute right-0 top-8 w-48 bg-white rounded-xl shadow-xl border border-gray-200 z-50">
                                <div class="py-2">
                                    <a href="{{ url_for('profile') }}" class="flex items-center px-4 py-2 text-secondary-700 hover:bg-primary-50 hover:text-primary-600">
                                        <i class="fas fa-user mr-3"></i>Profile
                                    </a>
                                    <a href="#" class="flex items-center px-4 py-2 text-secondary-700 hover:bg-primary-50 hover:text-primary-600">
                                        <i class="fas fa-cog mr-3"></i>Settings
                                    </a>
                                    <div class="border-t border-gray-100 my-2"></div>
                                    <a href="{{ url_for('logout') }}" class="flex items-center px-4 py-2 text-danger-600 hover:bg-danger-50">
                                        <i class="fas fa-sign-out-alt mr-3"></i>Sign Out
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    
    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Welcome Header with Enhanced 3D Effect -->
        <div class="mb-8 animate-fade-in">
            <div class="gradient-header from-primary-500 to-accent-500 p-8 text-white relative overflow-hidden">
                <!-- Enhanced Background Decorations -->
                <div class="absolute top-0 right-0 w-96 h-96 bg-white/10 rounded-full -mr-48 -mt-48 blur-3xl"></div>
                <div class="absolute bottom-0 left-0 w-64 h-64 bg-white/15 rounded-full -ml-32 -mb-32 blur-2xl"></div>
                <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-32 h-32 bg-white/5 rounded-full blur-xl"></div>
                
                <div class="relative z-10">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                        <div>
                            <h1 class="text-4xl md:text-5xl font-bold mb-3 text-shadow-lg">
                                Welcome back, {{ user.username }}! 
                                <span class="inline-block animate-bounce">👨‍🏫</span>
                            </h1>
                            <p class="text-primary-100 text-xl mb-6 font-medium">
                                Ready to inspire minds and shape futures? Let's create exceptional learning experiences.
                            </p>
                            <div class="flex items-center space-x-8 text-base glass-morphism p-4 rounded-2xl">
                                <div class="flex items-center">
                                    <div class="icon-3d icon-success mr-3" style="width: 40px; height: 40px;">
                                        <i class="fas fa-calendar text-white text-sm"></i>
                                    </div>
                                    <span class="font-semibold">{{ now.strftime('%B %d, %Y') }}</span>
                                </div>
                                <div class="flex items-center">
                                    <div class="icon-3d icon-accent mr-3" style="width: 40px; height: 40px;">
                                        <i class="fas fa-clock text-white text-sm"></i>
                                    </div>
                                    <span class="font-semibold" id="current-time">{{ now.strftime('%I:%M %p') }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 md:mt-0">
                            <div class="bg-white/20 backdrop-blur-sm rounded-2xl p-6 text-center">
                                <div class="text-3xl font-bold">{{ exam_count|default(0) }}</div>
                                <div class="text-primary-100">Total Exams</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Quick Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8 animate-slide-up">
            <!-- Total Exams with 3D Icon -->
            <div class="modern-card bg-gradient-to-br from-primary-50 to-primary-100 border-primary-200 hover-lift">
                <div class="flex items-center justify-between mb-6">
                    <div class="icon-3d icon-primary">
                        <i class="fas fa-clipboard-list text-white text-xl"></i>
                    </div>
                    <span class="text-3xl font-bold text-primary-700">{{ exam_count|default(0) }}</span>
                </div>
                <h3 class="font-bold text-primary-800 mb-2 text-lg">Total Exams</h3>
                <p class="text-primary-600 font-medium">Created by you</p>
            </div>

            <!-- Active Sessions with 3D Icon -->
            <div class="modern-card bg-gradient-to-br from-warning-50 to-warning-100 border-warning-200 hover-lift">
                <div class="flex items-center justify-between mb-6">
                    <div class="icon-3d icon-warning">
                        <i class="fas fa-users text-white text-xl"></i>
                    </div>
                    <span class="text-3xl font-bold text-warning-700">{{ active_sessions|default(0) }}</span>
                </div>
                <h3 class="font-bold text-warning-800 mb-2 text-lg">Active Sessions</h3>
                <p class="text-warning-600 font-medium">Students taking exams</p>
            </div>

            <!-- Total Results with 3D Icon -->
            <div class="modern-card bg-gradient-to-br from-success-50 to-success-100 border-success-200 hover-lift">
                <div class="flex items-center justify-between mb-6">
                    <div class="icon-3d icon-success">
                        <i class="fas fa-check-circle text-white text-xl"></i>
                    </div>
                    <span class="text-3xl font-bold text-success-700">{{ total_results|default(0) }}</span>
                </div>
                <h3 class="font-bold text-success-800 mb-2 text-lg">Completed</h3>
                <p class="text-success-600 font-medium">Total submissions</p>
            </div>

            <!-- Success Rate with 3D Icon -->
            <div class="modern-card bg-gradient-to-br from-accent-50 to-accent-100 border-accent-200 hover-lift">
                <div class="flex items-center justify-between mb-6">
                    <div class="icon-3d icon-accent">
                        <i class="fas fa-chart-line text-white text-xl"></i>
                    </div>
                    <span class="text-3xl font-bold text-accent-700">87%</span>
                </div>
                <h3 class="font-bold text-accent-800 mb-2 text-lg">Success Rate</h3>
                <p class="text-accent-600 font-medium">Average pass rate</p>
            </div>
        </div>

        <!-- Gamification Section -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8 animate-slide-up">
            <!-- Teacher Level & Progress -->
            <div class="modern-card bg-gradient-to-br from-purple-50 to-indigo-100 border-purple-200 hover-lift">
                <div class="flex items-center justify-between mb-6">
                    <div class="icon-3d" style="background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);">
                        <i class="fas fa-crown text-white text-xl"></i>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-purple-700">Level {{ teacher_stats.level if teacher_stats else 1 }}</div>
                        <div class="text-sm text-purple-600">Teaching Master</div>
                    </div>
                </div>
                <h3 class="font-bold text-purple-800 mb-3 text-lg">Your Progress</h3>
                <div class="space-y-3">
                    <div>
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-sm font-medium text-purple-700">XP Points</span>
                            <span class="text-sm font-bold text-purple-700">{{ teacher_stats.total_points if teacher_stats else 0 }}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill bg-gradient-to-r from-purple-400 to-purple-500" style="width: {{ ((teacher_stats.total_points if teacher_stats else 0) % 100) }}%"></div>
                        </div>
                        <div class="text-xs text-purple-600 mt-1">{{ 100 - ((teacher_stats.total_points if teacher_stats else 0) % 100) }} XP to next level</div>
                    </div>
                </div>
                <div class="mt-4 grid grid-cols-2 gap-4 text-center">
                    <div class="bg-white/50 rounded-lg p-3">
                        <div class="text-lg font-bold text-purple-700">{{ teacher_stats.total_exams_created if teacher_stats else 0 }}</div>
                        <div class="text-xs text-purple-600">Exams Created</div>
                    </div>
                    <div class="bg-white/50 rounded-lg p-3">
                        <div class="text-lg font-bold text-purple-700">{{ teacher_stats.total_students_taught if teacher_stats else 0 }}</div>
                        <div class="text-xs text-purple-600">Students Taught</div>
                    </div>
                </div>
            </div>

            <!-- Recent Achievements -->
            <div class="modern-card bg-gradient-to-br from-amber-50 to-yellow-100 border-amber-200 hover-lift">
                <div class="flex items-center justify-between mb-6">
                    <div class="icon-3d" style="background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);">
                        <i class="fas fa-trophy text-white text-xl"></i>
                    </div>
                    <span class="px-3 py-1 bg-amber-200 text-amber-800 rounded-full text-xs font-medium">
                        {{ achievements|length if achievements else 0 }} Earned
                    </span>
                </div>
                <h3 class="font-bold text-amber-800 mb-4 text-lg">Achievements</h3>
                
                {% if recent_achievements %}
                    <div class="space-y-3">
                        {% for achievement in recent_achievements %}
                        <div class="achievement-badge {{ achievement.badge_tier }}">
                            <div class="flex items-center">
                                <div class="achievement-icon mr-3">
                                    {% if achievement.badge_tier == 'gold' %}
                                        <i class="fas fa-medal text-yellow-500"></i>
                                    {% elif achievement.badge_tier == 'silver' %}
                                        <i class="fas fa-award text-gray-400"></i>
                                    {% else %}
                                        <i class="fas fa-certificate text-amber-600"></i>
                                    {% endif %}
                                </div>
                                <div class="flex-1">
                                    <div class="font-semibold text-sm">{{ achievement.achievement_name }}</div>
                                    <div class="text-xs opacity-80">+{{ achievement.points_awarded }} XP</div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-star text-amber-300 text-2xl mb-2"></i>
                        <p class="text-amber-700 text-sm">Start creating exams to earn achievements!</p>
                    </div>
                {% endif %}
                
                <button onclick="showAllAchievements()" class="w-full mt-4 text-center text-amber-700 hover:text-amber-800 text-sm font-medium">
                    View All Achievements <i class="fas fa-arrow-right ml-1"></i>
                </button>
            </div>

            <!-- Class Leaderboard -->
            <div class="modern-card bg-gradient-to-br from-emerald-50 to-green-100 border-emerald-200 hover-lift">
                <div class="flex items-center justify-between mb-6">
                    <div class="icon-3d" style="background: linear-gradient(135deg, #10B981 0%, #059669 100%);">
                        <i class="fas fa-users text-white text-xl"></i>
                    </div>
                    <span class="px-3 py-1 bg-emerald-200 text-emerald-800 rounded-full text-xs font-medium">
                        Top Students
                    </span>
                </div>
                <h3 class="font-bold text-emerald-800 mb-4 text-lg">Class Leaders</h3>
                
                {% if leaderboard %}
                    <div class="space-y-3">
                        {% for student, points, exams_taken in leaderboard %}
                        <div class="leaderboard-card">
                            <div class="flex items-center">
                                <div class="leaderboard-rank">{{ loop.index }}</div>
                                <div class="w-8 h-8 bg-gradient-to-r from-emerald-400 to-green-400 rounded-full flex items-center justify-center mr-3">
                                    <span class="text-white font-semibold text-xs">{{ student.username[0].upper() }}</span>
                                </div>
                                <div class="flex-1">
                                    <div class="font-semibold text-sm text-emerald-800">{{ student.username }}</div>
                                    <div class="text-xs text-emerald-600">{{ points.points }} points • Level {{ points.level }}</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm font-bold text-emerald-700">{{ exams_taken }}</div>
                                    <div class="text-xs text-emerald-600">exams</div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-graduation-cap text-emerald-300 text-2xl mb-2"></i>
                        <p class="text-emerald-700 text-sm">No student data yet</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Active Challenges & Virtual Classroom -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8 animate-slide-up">
            <!-- Active Challenges -->
            <div class="modern-card">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold text-secondary-900 flex items-center">
                        <div class="icon-3d icon-warning mr-3" style="width: 48px; height: 48px;">
                            <i class="fas fa-fire text-white text-lg"></i>
                        </div>
                        Active Challenges
                    </h2>
                    <div class="flex space-x-2">
                        <button onclick="manageChallenges()" class="px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-md text-sm font-medium">
                            <i class="fas fa-cog mr-2"></i>Manage
                        </button>
                        <button onclick="createChallenge()" class="px-4 py-2 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-lg hover:from-orange-600 hover:to-red-600 transition-all duration-200 shadow-md text-sm font-medium">
                            <i class="fas fa-plus mr-2"></i>Create Challenge
                        </button>
                    </div>
                </div>

                {% if active_challenges %}
                    <div class="space-y-4">
                        {% for challenge in active_challenges %}
                        <div class="challenge-card">
                            <div class="flex items-start justify-between mb-3">
                                <div class="flex-1">
                                    <h3 class="font-semibold text-secondary-900 mb-2">{{ challenge.title }}</h3>
                                    <p class="text-sm text-secondary-600 mb-3">{{ challenge.description }}</p>
                                    <div class="flex items-center space-x-4 text-xs text-secondary-500">
                                        <span><i class="fas fa-users mr-1"></i>{{ challenge.participants_count }} participants</span>
                                        <span><i class="fas fa-star mr-1"></i>{{ challenge.points_reward }} points</span>
                                    </div>
                                </div>
                                <div class="challenge-icon">
                                    {% if challenge.challenge_type == 'speed_quiz' %}
                                        <i class="fas fa-bolt text-yellow-500"></i>
                                    {% elif challenge.challenge_type == 'accuracy_challenge' %}
                                        <i class="fas fa-bullseye text-green-500"></i>
                                    {% else %}
                                        <i class="fas fa-trophy text-purple-500"></i>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="challenge-progress">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-xs font-medium">Time Remaining</span>
                                    <span class="text-xs font-bold">{{ ((challenge.end_date - now).days if (challenge.end_date - now).days > 0 else 0) }} days</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill bg-gradient-to-r from-orange-400 to-red-500" style="width: {{ 100 - (((challenge.end_date - now).days / ((challenge.end_date - challenge.start_date).days)) * 100) if ((challenge.end_date - challenge.start_date).days) > 0 else 0 }}%"></div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-8">
                        <div class="w-24 h-24 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-fire text-orange-400 text-3xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-secondary-700 mb-2">No Active Challenges</h3>
                        <p class="text-secondary-500 mb-6">Create engaging challenges to motivate your students!</p>
                        <button onclick="createChallenge()" class="px-6 py-3 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-lg hover:from-orange-600 hover:to-red-600 transition-all duration-200 shadow-lg font-medium">
                            <i class="fas fa-plus mr-2"></i>Create Your First Challenge
                        </button>
                    </div>
                {% endif %}
            </div>

            <!-- Virtual Classroom -->
            <div class="modern-card">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold text-secondary-900 flex items-center">
                        <div class="icon-3d icon-primary mr-3" style="width: 48px; height: 48px;">
                            <i class="fas fa-vr-cardboard text-white text-lg"></i>
                        </div>
                        Virtual Classroom
                    </h2>
                    <button onclick="enterVirtualClassroom()" class="px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all duration-200 shadow-md text-sm font-medium">
                        <i class="fas fa-play mr-2"></i>Enter
                    </button>
                </div>

                <div class="virtual-classroom-preview">
                    <div class="classroom-3d">
                        <div class="classroom-floor"></div>
                        <div class="classroom-walls">
                            <div class="wall wall-back"></div>
                            <div class="wall wall-left"></div>
                            <div class="wall wall-right"></div>
                        </div>
                        <div class="classroom-furniture">
                            <div class="desk desk-teacher"></div>
                            <div class="desk desk-student" style="--i: 1;"></div>
                            <div class="desk desk-student" style="--i: 2;"></div>
                            <div class="desk desk-student" style="--i: 3;"></div>
                            <div class="desk desk-student" style="--i: 4;"></div>
                        </div>
                        <div class="classroom-board">
                            <div class="board-content">
                                <div class="text-xs text-white font-semibold">{{ active_sessions }} students online</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-4 grid grid-cols-2 gap-4 text-center">
                    <div class="bg-blue-50 rounded-lg p-3">
                        <div class="text-lg font-bold text-blue-700">{{ active_sessions }}</div>
                        <div class="text-xs text-blue-600">Students Online</div>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-3">
                        <div class="text-lg font-bold text-purple-700">{{ exam_count }}</div>
                        <div class="text-xs text-purple-600">Available Exams</div>
                    </div>
                </div>

                <div class="mt-4 space-y-2">
                    <button onclick="startLiveSession()" class="w-full px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-lg hover:from-green-600 hover:to-emerald-600 transition-all duration-200 shadow-md text-sm font-medium">
                        <i class="fas fa-video mr-2"></i>Start Live Session
                    </button>
                    <button onclick="viewClassroomAnalytics()" class="w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all duration-200 text-sm font-medium">
                        <i class="fas fa-chart-line mr-2"></i>View Analytics
                    </button>
                </div>
            </div>
        </div>

        <!-- Quick Actions with 3D Premium Buttons -->
        <div class="mb-8 animate-slide-up">
            <h2 class="text-2xl font-bold text-secondary-900 mb-6 flex items-center">
                <div class="icon-3d icon-primary mr-3" style="width: 48px; height: 48px;">
                    <i class="fas fa-rocket text-white text-lg"></i>
                </div>
                Quick Actions
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <a href="{{ url_for('create_exam') }}" class="premium-btn text-center py-6 px-8 block">
                    <i class="fas fa-plus-circle text-2xl mb-3"></i>
                    <div class="font-bold text-lg">Create New Exam</div>
                    <div class="text-sm opacity-90">Design your next assessment</div>
                </a>
                <a href="{{ url_for('manage_exams') }}" class="premium-btn text-center py-6 px-8 block" style="background: linear-gradient(135deg, #10B981 0%, #059669 100%);">
                    <i class="fas fa-cog text-2xl mb-3"></i>
                    <div class="font-bold text-lg">Manage Exams</div>
                    <div class="text-sm opacity-90">Edit and configure exams</div>
                </a>
                <a href="{{ url_for('exam_results_list') }}" class="premium-btn text-center py-6 px-8 block" style="background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);">
                    <i class="fas fa-chart-bar text-2xl mb-3"></i>
                    <div class="font-bold text-lg">View Results</div>
                    <div class="text-sm opacity-90">Analyze student performance</div>
                </a>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Column - Recent Exams & Activity -->
            <div class="lg:col-span-2 space-y-6">
                
                <!-- Recent Exams -->
                <div class="modern-card animate-slide-up">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-secondary-900 flex items-center">
                            <i class="fas fa-clipboard-list mr-3 text-primary-500"></i>
                            Your Exams
                        </h2>
                        <a href="{{ url_for('manage_exams') }}" class="px-4 py-2 text-primary-500 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-all duration-200 text-sm">
                            View All <i class="fas fa-arrow-right ml-1"></i>
                        </a>
                    </div>

                    {% if exams %}
                        <div class="space-y-4">
                            {% for exam in exams[:5] %}
                            <div class="border border-gray-200 rounded-2xl p-6 hover:border-primary-300 hover:shadow-lg transition-all hover-lift">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="font-semibold text-secondary-900 text-lg mb-2">{{ exam.title }}</h3>
                                        <div class="flex items-center space-x-4 text-sm text-secondary-600 mb-4">
                                            <div class="flex items-center">
                                                <i class="fas fa-calendar mr-2 text-secondary-400"></i>
                                                <span>Created {{ exam.created_at.strftime('%b %d, %Y') }}</span>
                                            </div>
                                            <div class="flex items-center">
                                                <i class="fas fa-users mr-2 text-secondary-400"></i>
                                                <span>{{ exam.sessions_count if exam.sessions_count is defined else 'No' }} sessions</span>
                                            </div>
                                        </div>
                                        
                                        <!-- Status Indicators -->
                                        <div class="flex space-x-2">
                                            <span class="px-3 py-1 bg-success-100 text-success-700 rounded-full text-xs font-medium">
                                                Active
                                            </span>
                                            <span class="px-3 py-1 bg-primary-100 text-primary-700 rounded-full text-xs font-medium">
                                                AI Proctored
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="flex flex-col items-end space-y-2">
                                        <a href="{{ url_for('exam_results_for_exam', exam_id=exam.id) }}" 
                                           class="px-4 py-2 bg-gradient-to-r from-primary-500 to-accent-500 text-white rounded-lg hover:from-primary-600 hover:to-accent-600 transition-all duration-200 shadow-md text-sm font-medium">
                                            <i class="fas fa-chart-bar mr-2"></i>View Results
                                        </a>
                                        <div class="flex space-x-2">
                                            <a href="{{ url_for('edit_exam', exam_id=exam.id) }}" 
                                               class="text-secondary-500 hover:text-primary-500 text-sm">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <button class="text-secondary-500 hover:text-danger-500 text-sm">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-12">
                            <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-clipboard-list text-gray-400 text-3xl"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-secondary-700 mb-2">No Exams Created Yet</h3>
                            <p class="text-secondary-500 mb-6">Create your first exam to get started with QUIZZO.</p>
                            <a href="{{ url_for('create_exam') }}" class="px-6 py-3 bg-gradient-to-r from-primary-500 to-accent-500 text-white rounded-lg hover:from-primary-600 hover:to-accent-600 transition-all duration-200 shadow-lg font-medium">
                                <i class="fas fa-plus mr-2"></i>Create Your First Exam
                            </a>
                        </div>
                    {% endif %}
                </div>

                <!-- Live Activity Feed -->
                <div class="modern-card animate-slide-up" style="animation-delay: 0.2s;">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-secondary-900 flex items-center">
                            <i class="fas fa-activity mr-3 text-accent-500"></i>
                            Live Activity
                        </h2>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                            <span class="text-sm text-gray-600">Live</span>
                        </div>
                    </div>
                    
                    <div class="space-y-4 max-h-96 overflow-y-auto">
                        {% if live_activities %}
                            {% for activity in live_activities %}
                                <div class="flex items-center space-x-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200 hover:shadow-md transition-all duration-200">
                                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full flex items-center justify-center">
                                        <i class="fas fa-user-edit text-white"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <p class="font-semibold text-blue-800">{{ activity.student_name }}</p>
                                            <div class="flex items-center text-green-600">
                                                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse mr-2"></div>
                                                <span class="text-xs font-medium">ACTIVE</span>
                                            </div>
                                        </div>
                                        <p class="text-blue-700 text-sm font-medium">{{ activity.exam_title }}</p>
                                        <div class="flex items-center space-x-4 mt-2">
                                            <span class="text-xs text-blue-600">⏱️ {{ activity.elapsed_minutes }}m elapsed</span>
                                            <span class="text-xs text-blue-600">📝 {{ activity.answered_questions }}/{{ activity.total_questions }} answered</span>
                                            <span class="text-xs text-blue-600">📊 {{ activity.progress }}% complete</span>
                                        </div>
                                        {% if activity.recent_alerts %}
                                            <div class="mt-2 flex space-x-1">
                                                {% for alert in activity.recent_alerts[:2] %}
                                                    <span class="text-xs px-2 py-1 rounded-full {% if alert.severity == 'critical' %}bg-red-100 text-red-600{% elif alert.severity == 'high' %}bg-orange-100 text-orange-600{% else %}bg-yellow-100 text-yellow-600{% endif %}">
                                                        {{ alert.alert_type.replace('_', ' ').title() }}
                                                    </span>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <!-- Progress Bar -->
                                    <div class="w-16">
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-blue-500 to-indigo-500 h-2 rounded-full transition-all duration-300" style="width: {{ activity.progress }}%"></div>
                                        </div>
                                        <span class="text-xs text-gray-600 block text-center mt-1">{{ activity.progress }}%</span>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="text-center py-8">
                                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <i class="fas fa-sleep text-gray-400 text-xl"></i>
                                </div>
                                <p class="text-secondary-600">No active exam sessions</p>
                                <p class="text-secondary-500 text-sm">Students will appear here when they start taking exams</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Activity History -->
                <div class="modern-card animate-slide-up" style="animation-delay: 0.3s;">
                    <h2 class="text-xl font-bold text-secondary-900 flex items-center mb-6">
                        <i class="fas fa-history mr-3 text-secondary-500"></i>
                        Recent Activity (24h)
                    </h2>
                    
                    <div class="space-y-3 max-h-80 overflow-y-auto">
                        {% if activity_history %}
                            {% for history in activity_history %}
                                <div class="flex items-center space-x-4 p-3 {% if history.status == 'completed' %}bg-green-50 border border-green-200{% else %}bg-red-50 border border-red-200{% endif %} rounded-lg hover:shadow-sm transition-all duration-200">
                                    <div class="w-10 h-10 {% if history.status == 'completed' %}bg-green-500{% else %}bg-red-500{% endif %} rounded-full flex items-center justify-center">
                                        <i class="fas {% if history.status == 'completed' %}fa-check{% else %}fa-times{% endif %} text-white text-sm"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <p class="font-medium {% if history.status == 'completed' %}text-green-800{% else %}text-red-800{% endif %}">{{ history.student_name }}</p>
                                            <span class="text-xs {% if history.status == 'completed' %}text-green-600{% else %}text-red-600{% endif %}">
                                                {{ history.end_time.strftime('%H:%M') }} • {{ history.duration_minutes }}m
                                            </span>
                                        </div>
                                        <p class="text-sm text-gray-700">{{ history.exam_title }}</p>
                                        {% if history.status == 'completed' %}
                                            <p class="text-xs text-green-600 font-medium">✅ Completed • Score: {{ "%.0f"|format(history.score_percentage) }}%</p>
                                        {% else %}
                                            <p class="text-xs text-red-600 font-medium">⚠️ Disqualified • Violation detected</p>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="text-center py-6">
                                <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <i class="fas fa-clock text-gray-400"></i>
                                </div>
                                <p class="text-secondary-600 text-sm">No recent activity</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Right Column - Quick Actions & Analytics -->
            <div class="space-y-6">
                
                <!-- Quick Actions -->
                <div class="modern-card animate-slide-up" style="animation-delay: 0.1s;">
                    <h2 class="text-lg font-bold text-secondary-900 mb-6 flex items-center">
                        <i class="fas fa-bolt mr-3 text-warning-500"></i>
                        Quick Actions
                    </h2>
                    
                    <div class="space-y-3">
                        <a href="{{ url_for('create_exam') }}" 
                           class="flex items-center justify-between p-4 bg-primary-50 hover:bg-primary-100 rounded-xl transition-all group">
                            <div class="flex items-center">
                                <i class="fas fa-plus-circle text-primary-500 mr-3"></i>
                                <span class="font-medium text-primary-700">Create New Exam</span>
                            </div>
                            <i class="fas fa-arrow-right text-primary-400 group-hover:translate-x-1 transition-transform"></i>
                        </a>
                        
                        <a href="{{ url_for('manage_exams') }}" 
                           class="flex items-center justify-between p-4 bg-success-50 hover:bg-success-100 rounded-xl transition-all group">
                            <div class="flex items-center">
                                <i class="fas fa-cog text-success-500 mr-3"></i>
                                <span class="font-medium text-success-700">Manage Exams</span>
                            </div>
                            <i class="fas fa-arrow-right text-success-400 group-hover:translate-x-1 transition-transform"></i>
                        </a>
                        
                        <a href="{{ url_for('exam_results_list') }}" 
                           class="flex items-center justify-between p-4 bg-accent-50 hover:bg-accent-100 rounded-xl transition-all group">
                            <div class="flex items-center">
                                <i class="fas fa-chart-bar text-accent-500 mr-3"></i>
                                <span class="font-medium text-accent-700">View All Results</span>
                            </div>
                            <i class="fas fa-arrow-right text-accent-400 group-hover:translate-x-1 transition-transform"></i>
                        </a>
                        
                        <button class="w-full flex items-center justify-between p-4 bg-secondary-50 hover:bg-secondary-100 rounded-xl transition-all group">
                            <div class="flex items-center">
                                <i class="fas fa-download text-secondary-500 mr-3"></i>
                                <span class="font-medium text-secondary-700">Export Data</span>
                            </div>
                            <i class="fas fa-arrow-right text-secondary-400 group-hover:translate-x-1 transition-transform"></i>
                        </button>
                    </div>
                </div>

                <!-- Performance Overview -->
                <div class="modern-card animate-slide-up" style="animation-delay: 0.4s;">
                    <h2 class="text-lg font-bold text-secondary-900 mb-4 flex items-center">
                        <i class="fas fa-chart-pie mr-3 text-primary-500"></i>
                        Performance Overview
                    </h2>
                    
                    <div class="space-y-4">
                        <!-- Pass Rate -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm font-medium text-secondary-700">Pass Rate</span>
                                <span class="text-sm font-bold text-success-600">87%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill bg-gradient-to-r from-success-400 to-success-500" style="width: 87%"></div>
                            </div>
                        </div>
                        
                        <!-- Average Score -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm font-medium text-secondary-700">Average Score</span>
                                <span class="text-sm font-bold text-primary-600">76%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill bg-gradient-to-r from-primary-400 to-primary-500" style="width: 76%"></div>
                            </div>
                        </div>
                        
                        <!-- Completion Rate -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm font-medium text-secondary-700">Completion Rate</span>
                                <span class="text-sm font-bold text-accent-600">94%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill bg-gradient-to-r from-accent-400 to-accent-500" style="width: 94%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 pt-4 border-t border-gray-200">
                        <a href="{{ url_for('exam_results_list') }}" class="px-4 py-2 text-primary-500 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-all duration-200 w-full text-center text-sm">
                            View Detailed Analytics <i class="fas fa-chart-line ml-2"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Mobile Navigation -->
<div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 md:hidden z-40">
    <div class="grid grid-cols-4 gap-1 p-2">
        <a href="{{ url_for('dashboard') }}" class="flex flex-col items-center py-2 text-[#8B5C2A]">
            <i class="fas fa-tachometer-alt text-lg mb-1"></i>
            <span class="text-xs font-medium">Dashboard</span>
        </a>
        <a href="{{ url_for('create_exam') }}" class="flex flex-col items-center py-2 text-gray-500">
            <i class="fas fa-plus-circle text-lg mb-1"></i>
            <span class="text-xs">Create</span>
        </a>
        <a href="{{ url_for('manage_exams') }}" class="flex flex-col items-center py-2 text-gray-500">
            <i class="fas fa-clipboard-list text-lg mb-1"></i>
            <span class="text-xs">Manage</span>
        </a>
        <a href="{{ url_for('exam_results_list') }}" class="flex flex-col items-center py-2 text-gray-500">
            <i class="fas fa-chart-bar text-lg mb-1"></i>
            <span class="text-xs">Results</span>
        </a>
    </div>
</div>

<script>
    // Update time
    function updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('en-US', { 
            hour: 'numeric', 
            minute: '2-digit',
            hour12: true 
        });
        document.getElementById('current-time').textContent = timeString;
    }
    
    setInterval(updateTime, 1000);
    
    // Toggle user menu
    function toggleUserMenu() {
        const menu = document.getElementById('user-menu');
        menu.classList.toggle('hidden');
    }
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', function(event) {
        const userMenu = document.getElementById('user-menu');
        
        if (!event.target.closest('[onclick="toggleUserMenu()"]') && !userMenu.contains(event.target)) {
            userMenu.classList.add('hidden');
        }
    });
    
    // AI Auto-Generate Exam Functions
    function openAutoGenerateModal() {
        document.getElementById('autoGenerateModal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }
    
    function closeAutoGenerateModal() {
        document.getElementById('autoGenerateModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
        resetGenerationForm();
    }
    
    function resetGenerationForm() {
        document.getElementById('autoGenerateForm').reset();
        document.getElementById('selectedTopics').innerHTML = '';
        document.getElementById('generationProgress').classList.add('hidden');
        document.getElementById('generationResult').classList.add('hidden');
        document.querySelector('.generation-form').classList.remove('hidden');
    }
    
    function addTopic() {
        const topicInput = document.getElementById('examTopic');
        const topic = topicInput.value.trim();
        
        if (topic && !isTopicSelected(topic)) {
            const topicElement = document.createElement('div');
            topicElement.className = 'inline-flex items-center bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm';
            topicElement.innerHTML = `
                <span>${topic}</span>
                <button type="button" onclick="removeTopic(this)" class="ml-2 text-purple-600 hover:text-purple-800">
                    <i class="fas fa-times"></i>
                </button>
            `;
            document.getElementById('selectedTopics').appendChild(topicElement);
            topicInput.value = '';
        }
    }
    
    function removeTopic(button) {
        button.parentElement.remove();
    }
    
    function isTopicSelected(topic) {
        const selectedTopics = document.querySelectorAll('#selectedTopics span');
        return Array.from(selectedTopics).some(span => span.textContent === topic);
    }
    
    function generateExam() {
        const formData = new FormData(document.getElementById('autoGenerateForm'));
        const selectedTopics = Array.from(document.querySelectorAll('#selectedTopics span'))
            .map(span => span.textContent);
        
        if (selectedTopics.length === 0) {
            alert('Please add at least one topic');
            return;
        }
        
        // Collect question types
        const questionTypes = Array.from(document.querySelectorAll('input[name="questionTypes"]:checked'))
            .map(input => input.value);
        
        if (questionTypes.length === 0) {
            alert('Please select at least one question type');
            return;
        }
        
        // Hide form and show progress
        document.querySelector('.generation-form').classList.add('hidden');
        document.getElementById('generationProgress').classList.remove('hidden');
        
        // Prepare data for backend
        const examData = {
            examTitle: formData.get('examTitle'),
            topics: selectedTopics,
            questionCount: parseInt(formData.get('questionCount')),
            difficulty: formData.get('difficulty'),
            duration: parseInt(formData.get('duration')),
            questionTypes: questionTypes
        };
        
        // Call backend API with progress simulation
        simulateProgressWithAPI(examData);
    }
    
    function showGenerationSuccess(data, examData) {
        document.getElementById('generationProgress').classList.add('hidden');
        document.getElementById('generationResult').classList.remove('hidden');
        
        // Display generated exam info
        document.getElementById('resultExamTitle').textContent = examData.examTitle;
        document.getElementById('resultQuestionCount').textContent = examData.questionCount;
        document.getElementById('resultDifficulty').textContent = examData.difficulty;
        document.getElementById('resultTopics').textContent = examData.topics.join(', ');
        
        // Store exam ID for later use
        window.generatedExamId = data.exam_id;
        
        // Display preview questions
        displayPreviewQuestions(data.preview || []);
        
        // Show success message
        const successMsg = document.createElement('div');
        successMsg.className = 'mb-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded-lg';
        successMsg.innerHTML = `<i class="fas fa-check-circle mr-2"></i>${data.message}`;
        document.getElementById('generationResult').insertBefore(successMsg, document.getElementById('generationResult').firstChild);
    }
    
    function showGenerationError(error) {
        document.getElementById('generationProgress').classList.add('hidden');
        
        // Show error message
        const errorDiv = document.createElement('div');
        errorDiv.className = 'text-center py-12';
        errorDiv.innerHTML = `
            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-exclamation-triangle text-red-500 text-2xl"></i>
            </div>
            <h3 class="text-xl font-semibold text-gray-800 mb-2">Generation Failed</h3>
            <p class="text-red-600 mb-4">${error}</p>
            <button onclick="resetGenerationForm()" 
                    class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                Try Again
            </button>
        `;
        
        document.querySelector('.generation-form').classList.add('hidden');
        const modalContent = document.querySelector('#autoGenerateModal .p-6');
        modalContent.appendChild(errorDiv);
    }
    
    function displayPreviewQuestions(questions) {
        const questionsContainer = document.getElementById('generatedQuestions');
        questionsContainer.innerHTML = '';
        
        questions.forEach((q, index) => {
            const questionDiv = document.createElement('div');
            questionDiv.className = 'border border-gray-200 rounded-lg p-4';
            
            if (q.type === 'multiple_choice') {
                questionDiv.innerHTML = `
                    <h4 class="font-medium text-gray-800 mb-3">Question ${index + 1} (Multiple Choice)</h4>
                    <p class="text-gray-700 mb-3">${q.question}</p>
                    <div class="space-y-2">
                        ${q.options.map((option, idx) => `
                            <div class="flex items-center">
                                <input type="radio" name="preview_q${index}" disabled ${idx === q.correct_option ? 'checked' : ''}>
                                <label class="ml-2 text-sm ${idx === q.correct_option ? 'text-green-600 font-medium' : 'text-gray-600'}">${option}</label>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else if (q.type === 'true_false') {
                questionDiv.innerHTML = `
                    <h4 class="font-medium text-gray-800 mb-3">Question ${index + 1} (True/False)</h4>
                    <p class="text-gray-700 mb-3">${q.question}</p>
                    <div class="space-y-2">
                        <div class="flex items-center">
                            <input type="radio" name="preview_q${index}" disabled ${q.correct_option === 0 ? 'checked' : ''}>
                            <label class="ml-2 text-sm ${q.correct_option === 0 ? 'text-green-600 font-medium' : 'text-gray-600'}">True</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" name="preview_q${index}" disabled ${q.correct_option === 1 ? 'checked' : ''}>
                            <label class="ml-2 text-sm ${q.correct_option === 1 ? 'text-green-600 font-medium' : 'text-gray-600'}">False</label>
                        </div>
                    </div>
                `;
            } else {
                questionDiv.innerHTML = `
                    <h4 class="font-medium text-gray-800 mb-3">Question ${index + 1} (Short Answer)</h4>
                    <p class="text-gray-700 mb-3">${q.question}</p>
                    <div class="bg-green-50 border border-green-200 rounded p-3">
                        <p class="text-sm text-green-700"><strong>Sample Answer:</strong> ${q.answer}</p>
                    </div>
                `;
            }
            
            questionsContainer.appendChild(questionDiv);
        });
    }
    
    function saveGeneratedExam() {
        if (window.generatedExamId) {
            // Exam is already saved, just redirect to manage exams
            window.location.href = '/manage_exams';
        } else {
            alert('No exam to save. Please generate an exam first.');
        }
    }
    
    function simulateProgressWithAPI(examData) {
        const progressBar = document.querySelector('.ai-progress-fill');
        const progressText = document.querySelector('.progress-text');
        const progressSteps = [
            'Analyzing topics and difficulty level...',
            'Generating questions using AI...',
            'Creating multiple choice options...',
            'Optimizing question distribution...',
            'Finalizing exam structure...',
            'Saving exam to database...'
        ];
        
        let currentStep = 0;
        let apiCalled = false;
        
        const progressInterval = setInterval(() => {
            const progress = ((currentStep + 1) / progressSteps.length) * 100;
            progressBar.style.width = progress + '%';
            progressText.textContent = progressSteps[currentStep];
            
            // Call API when we're halfway through the progress
            if (currentStep === 2 && !apiCalled) {
                apiCalled = true;
                callGenerationAPI(examData, progressInterval, currentStep, progressSteps.length);
            }
            
            currentStep++;
            
            if (currentStep >= progressSteps.length && apiCalled) {
                clearInterval(progressInterval);
                // API call will handle the final result display
            }
        }, 1200);
    }
    
    function callGenerationAPI(examData, progressInterval, currentStep, totalSteps) {
        fetch('/generate_ai_exam', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(examData)
        })
        .then(response => response.json())
        .then(data => {
            // Wait for progress animation to complete
            setTimeout(() => {
                clearInterval(progressInterval);
                
                if (data.success) {
                    showGenerationSuccess(data, examData);
                } else {
                    showGenerationError(data.error || 'Failed to generate exam');
                }
            }, (totalSteps - currentStep) * 1200);
        })
        .catch(error => {
            console.error('Error:', error);
            setTimeout(() => {
                clearInterval(progressInterval);
                showGenerationError('Network error occurred. Please try again.');
            }, 1000);
        });
    }
    
    // Initialize animations
    document.addEventListener('DOMContentLoaded', function() {
        // Add stagger animation to cards
        const cards = document.querySelectorAll('.animate-slide-up');
        cards.forEach((card, index) => {
            card.style.animationDelay = `${index * 0.1}s`;
        });
        
        // Real-time updates simulation
        setInterval(() => {
            // You can add real-time updates here
            // For example, refreshing active sessions count
        }, 30000); // Every 30 seconds
    });
</script>

<!-- AI Auto-Generate Exam Modal -->
<div id="autoGenerateModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <!-- Modal Header -->
        <div class="bg-gradient-to-r from-purple-500 to-blue-500 text-white p-6 rounded-t-2xl">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center mr-4">
                        <i class="fas fa-robot text-2xl"></i>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold">AI Exam Generator</h3>
                        <p class="text-purple-100">Create intelligent exams automatically</p>
                    </div>
                </div>
                <button onclick="closeAutoGenerateModal()" class="text-white/80 hover:text-white text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <!-- Modal Content -->
        <div class="p-6">
            <!-- Generation Form -->
            <div class="generation-form">
                <form id="autoGenerateForm" onsubmit="event.preventDefault(); generateExam();">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Left Column -->
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <i class="fas fa-tag text-purple-500 mr-2"></i>Exam Title
                                </label>
                                <input type="text" name="examTitle" required
                                       placeholder="e.g., Mathematics Midterm Exam"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <i class="fas fa-clock text-purple-500 mr-2"></i>Exam Duration (minutes)
                                </label>
                                <select name="duration" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                    <option value="30">30 minutes</option>
                                    <option value="45">45 minutes</option>
                                    <option value="60" selected>1 hour</option>
                                    <option value="90">1.5 hours</option>
                                    <option value="120">2 hours</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <i class="fas fa-list-ol text-purple-500 mr-2"></i>Number of Questions
                                </label>
                                <input type="number" name="questionCount" min="5" max="50" value="10" required
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <i class="fas fa-chart-line text-purple-500 mr-2"></i>Difficulty Level
                                </label>
                                <select name="difficulty" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                    <option value="Easy">Easy</option>
                                    <option value="Medium" selected>Medium</option>
                                    <option value="Hard">Hard</option>
                                    <option value="Mixed">Mixed (All Levels)</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Right Column -->
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <i class="fas fa-lightbulb text-purple-500 mr-2"></i>Topics to Cover
                                </label>
                                <div class="flex space-x-2 mb-3">
                                    <input type="text" id="examTopic" placeholder="Enter a topic..."
                                           class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                           onkeypress="if(event.key==='Enter'){event.preventDefault();addTopic();}">
                                    <button type="button" onclick="addTopic()" 
                                            class="px-4 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div id="selectedTopics" class="flex flex-wrap gap-2 min-h-[40px] p-3 border border-gray-200 rounded-lg bg-gray-50"></div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <i class="fas fa-cog text-purple-500 mr-2"></i>Question Types
                                </label>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="questionTypes" value="multiple_choice" checked class="rounded text-purple-500">
                                        <span class="ml-2 text-sm">Multiple Choice</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="questionTypes" value="true_false" class="rounded text-purple-500">
                                        <span class="ml-2 text-sm">True/False</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="questionTypes" value="short_answer" class="rounded text-purple-500">
                                        <span class="ml-2 text-sm">Short Answer</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg border border-blue-200">
                                <h4 class="font-semibold text-blue-800 mb-2">
                                    <i class="fas fa-magic mr-2"></i>AI Features
                                </h4>
                                <div class="space-y-2 text-sm text-blue-700">
                                    <div class="flex items-center">
                                        <i class="fas fa-check text-green-500 mr-2"></i>
                                        Smart question generation
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-check text-green-500 mr-2"></i>
                                        Adaptive difficulty balancing
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-check text-green-500 mr-2"></i>
                                        Plagiarism-resistant options
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8 flex justify-end space-x-4">
                        <button type="button" onclick="closeAutoGenerateModal()" 
                                class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" 
                                class="px-8 py-3 bg-gradient-to-r from-purple-500 to-blue-500 text-white rounded-lg hover:from-purple-600 hover:to-blue-600 transition-all transform hover:scale-105">
                            <i class="fas fa-magic mr-2"></i>Generate Exam
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Generation Progress -->
            <div id="generationProgress" class="hidden text-center py-12">
                <div class="w-24 h-24 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse">
                    <i class="fas fa-robot text-white text-3xl"></i>
                </div>
                <h3 class="text-xl font-semibold text-gray-800 mb-4">AI is generating your exam...</h3>
                <div class="max-w-md mx-auto">
                    <div class="bg-gray-200 rounded-full h-3 mb-4">
                        <div class="ai-progress-fill bg-gradient-to-r from-purple-500 to-blue-500 h-3 rounded-full transition-all duration-1000" style="width: 0%"></div>
                    </div>
                    <p class="progress-text text-gray-600 text-sm">Initializing AI engine...</p>
                </div>
            </div>
            
            <!-- Generation Result -->
            <div id="generationResult" class="hidden">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-check text-green-500 text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">Exam Generated Successfully!</h3>
                    <p class="text-gray-600">Your AI-powered exam is ready for review</p>
                </div>
                
                <!-- Exam Summary -->
                <div class="bg-gray-50 rounded-xl p-6 mb-6">
                    <h4 class="font-semibold text-gray-800 mb-4">Exam Summary</h4>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-600">Title:</span>
                            <span id="resultExamTitle" class="font-medium text-gray-800 ml-2"></span>
                        </div>
                        <div>
                            <span class="text-gray-600">Questions:</span>
                            <span id="resultQuestionCount" class="font-medium text-gray-800 ml-2"></span>
                        </div>
                        <div>
                            <span class="text-gray-600">Difficulty:</span>
                            <span id="resultDifficulty" class="font-medium text-gray-800 ml-2"></span>
                        </div>
                        <div>
                            <span class="text-gray-600">Topics:</span>
                            <span id="resultTopics" class="font-medium text-gray-800 ml-2"></span>
                        </div>
                    </div>
                </div>
                
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Mobile Navigation -->
<div class="md:hidden">
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50">
        <div class="grid grid-cols-4 gap-1">
            <a href="{{ url_for('dashboard') }}" class="flex flex-col items-center py-2 px-1 text-primary-500">
                <i class="fas fa-home text-lg"></i>
                <span class="text-xs mt-1">Dashboard</span>
            </a>
            <a href="{{ url_for('create_exam') }}" class="flex flex-col items-center py-2 px-1 text-secondary-500">
                <i class="fas fa-plus-circle text-lg"></i>
                <span class="text-xs mt-1">Create</span>
            </a>
            <a href="{{ url_for('manage_exams') }}" class="flex flex-col items-center py-2 px-1 text-secondary-500">
                <i class="fas fa-clipboard-list text-lg"></i>
                <span class="text-xs mt-1">Manage</span>
            </a>
            <a href="{{ url_for('exam_results_list') }}" class="flex flex-col items-center py-2 px-1 text-secondary-500">
                <i class="fas fa-chart-bar text-lg"></i>
                <span class="text-xs mt-1">Results</span>
            </a>
        </div>
    </div>
</div>

<script>
    // Modern Dashboard JavaScript
    function toggleNotifications() {
        const dropdown = document.getElementById('notifications-dropdown');
        if (dropdown) {
            dropdown.classList.toggle('hidden');
        }
    }

    function toggleUserMenu() {
        const menu = document.getElementById('user-menu');
        if (menu) {
            menu.classList.toggle('hidden');
        }
    }

    // Notification Functions
    function markAsRead(notificationElement) {
        // Remove the unread indicator
        const indicator = notificationElement.querySelector('.w-2.h-2');
        if (indicator) {
            indicator.remove();
        }
        
        // Add read styling
        notificationElement.style.opacity = '0.7';
        
        // Update notification count
        updateNotificationCount();
    }

    function markAllAsRead() {
        const notifications = document.querySelectorAll('.notification-item');
        notifications.forEach(notification => {
            const indicator = notification.querySelector('.w-2.h-2');
            if (indicator) {
                indicator.remove();
            }
            notification.style.opacity = '0.7';
        });
        
        // Hide notification badge
        const badge = document.getElementById('notification-badge');
        if (badge) {
            badge.style.display = 'none';
        }
        
        // Show success message
        showNotification('All notifications marked as read', 'success');
    }

    function updateNotificationCount() {
        const unreadNotifications = document.querySelectorAll('.notification-item .w-2.h-2').length;
        const badge = document.getElementById('notification-badge');
        
        if (badge) {
            if (unreadNotifications === 0) {
                badge.style.display = 'none';
            } else {
                badge.style.display = 'block';
            }
        }
    }

    // Close dropdowns when clicking outside
    document.addEventListener('click', function(event) {
        const notificationsDropdown = document.getElementById('notifications-dropdown');
        const userMenu = document.getElementById('user-menu');
        
        // Check if click is outside notifications
        if (notificationsDropdown && !event.target.closest('.relative')) {
            if (notificationsDropdown) notificationsDropdown.classList.add('hidden');
        }
        
        // Check if click is outside user menu
        if (userMenu && !event.target.closest('.relative')) {
            if (userMenu) userMenu.classList.add('hidden');
        }
    });

    // Update time every minute
    function updateTime() {
        const timeElement = document.getElementById('current-time');
        if (timeElement) {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', {
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
            timeElement.textContent = timeString;
        }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        updateTime();
        setInterval(updateTime, 60000); // Update every minute

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            const notificationsDropdown = document.getElementById('notifications-dropdown');
            const userMenu = document.getElementById('user-menu');
            
            if (!event.target.closest('.relative')) {
                if (notificationsDropdown) notificationsDropdown.classList.add('hidden');
                if (userMenu) userMenu.classList.add('hidden');
            }
        });

        // Add animations to cards
        const cards = document.querySelectorAll('.animate-slide-up');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, { threshold: 0.1 });

        cards.forEach(card => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'opacity 0.6s ease-out, transform 0.6s ease-out';
            observer.observe(card);
        });
    });

    // Gamification Functions
    function showAllAchievements() {
        // Create modal for all achievements
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4';
        modal.innerHTML = `
            <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                <div class="bg-gradient-to-r from-amber-500 to-yellow-500 text-white p-6 rounded-t-2xl">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <i class="fas fa-trophy text-2xl mr-3"></i>
                            <h3 class="text-2xl font-bold">Your Achievements</h3>
                        </div>
                        <button onclick="this.closest('.fixed').remove()" class="text-white/80 hover:text-white text-2xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <div class="text-center py-8">
                        <i class="fas fa-trophy text-6xl text-amber-400 mb-4"></i>
                        <h3 class="text-xl font-bold text-gray-700 mb-2">No Achievements Yet</h3>
                        <p class="text-gray-500">Start creating exams to unlock achievements!</p>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
    }

    function createChallenge() {
        window.location.href = '/create_challenge';
    }

    function manageChallenges() {
        window.location.href = '/challenges';
    }

    function enterVirtualClassroom() {
        window.location.href = '/virtual-classroom';
    }

    function startLiveSession() {
        window.location.href = '/virtual-classroom';
    }

    function viewClassroomAnalytics() {
        window.location.href = '{{ url_for("exam_results_list") }}';
    }

    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = 'fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm';
        
        const bgColors = {
            'success': 'bg-green-500',
            'error': 'bg-red-500',
            'warning': 'bg-yellow-500',
            'info': 'bg-blue-500'
        };
        
        const icons = {
            'success': 'check',
            'error': 'exclamation',
            'warning': 'exclamation-triangle',
            'info': 'info'
        };
        
        notification.className += ` ${bgColors[type] || bgColors.info} text-white`;
        
        notification.innerHTML = `
            <div class="flex items-center">
                <i class="fas fa-${icons[type] || icons.info}-circle mr-3"></i>
                <span>${message}</span>
                <button onclick="this.parentElement.parentElement.remove()" class="ml-3 text-white/80 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
            if (notification.parentElement) {
                notification.remove();
            }
        }, 5000);
    }

    // Initialize gamification features
    setTimeout(() => {
        // Animate achievement counters
        const counters = document.querySelectorAll('.text-3xl');
        counters.forEach(counter => {
            const target = parseInt(counter.textContent);
            if (!isNaN(target)) {
                const increment = Math.max(1, target / 20);
                let current = 0;
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        counter.textContent = target;
                        clearInterval(timer);
                    } else {
                        counter.textContent = Math.floor(current);
                    }
                }, 50);
            }
        });

        // Show new achievement notifications if any
        {% if new_achievements %}
            {% for achievement in new_achievements %}
                setTimeout(() => {
                    showAchievementNotification('{{ achievement.achievement_name }}', '{{ achievement.points_awarded }}');
                }, {{ loop.index * 2000 }});
            {% endfor %}
        {% endif %}
    }, 1000);

    function showAchievementNotification(name, points) {
        const notification = document.createElement('div');
        notification.className = 'fixed top-4 right-4 z-50 achievement-notification animate-bounce';
        notification.innerHTML = `
            <div class="bg-gradient-to-r from-amber-500 to-yellow-500 text-white p-4 rounded-lg shadow-lg max-w-sm">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-trophy text-xl"></i>
                    </div>
                    <div>
                        <div class="font-bold">Achievement Unlocked!</div>
                        <div class="text-sm">${name}</div>
                        <div class="text-xs">+${points} XP</div>
                    </div>
                    <button onclick="this.closest('.achievement-notification').remove()" class="ml-3 text-white/80 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        `;
        document.body.appendChild(notification);
        
        // Auto-remove after 7 seconds
        setTimeout(() => {
            if (notification.parentElement) {
                notification.remove();
            }
        }, 7000);
    }
</script>

{% endblock %}
