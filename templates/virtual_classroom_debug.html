{% extends "base.html" %}

{% block title %}Virtual Classroom Debug - QUIZZO{% endblock %}

{% block head %}
<script src="https://cdn.tailwindcss.com"></script>
<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
<style>
    [x-cloak] { display: none !important; }
</style>
{% endblock %}

{% block body %}
<div class="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 p-6">
    
    <!-- Debug Panel -->
    <div class="max-w-4xl mx-auto mb-8">
        <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 mb-6">
            <h2 class="text-xl font-bold text-white mb-4">ðŸ”§ Debug Information</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
                <div class="bg-white/20 rounded-lg p-3">
                    <div class="text-white/70">User ID:</div>
                    <div class="text-white font-mono">{{ user.id if user else 'None' }}</div>
                </div>
                <div class="bg-white/20 rounded-lg p-3">
                    <div class="text-white/70">Username:</div>
                    <div class="text-white font-mono">{{ user.username if user else 'None' }}</div>
                </div>
                <div class="bg-white/20 rounded-lg p-3">
                    <div class="text-white/70">Role:</div>
                    <div class="text-white font-mono">{{ user.role if user else 'None' }}</div>
                </div>
                <div class="bg-white/20 rounded-lg p-3">
                    <div class="text-white/70">Is Lecturer:</div>
                    <div class="text-white font-mono">{{ 'YES' if user and user.role == 'lecturer' else 'NO' }}</div>
                </div>
            </div>
            
            <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div class="bg-white/20 rounded-lg p-3">
                    <div class="text-white/70">Active Sessions:</div>
                    <div class="text-white font-mono">{{ active_sessions|length }}</div>
                </div>
                <div class="bg-white/20 rounded-lg p-3">
                    <div class="text-white/70">My Sessions:</div>
                    <div class="text-white font-mono">{{ my_sessions|length }}</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Test AlpineJS -->
    <div class="max-w-4xl mx-auto" x-data="{ 
        showCreateModal: false,
        showJoinModal: false,
        testMessage: 'AlpineJS is working!'
    }" x-cloak>
        
        <!-- AlpineJS Test -->
        <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 mb-6">
            <h2 class="text-xl font-bold text-white mb-4">ðŸ§ª AlpineJS Test</h2>
            <div class="space-y-4">
                <div class="text-white" x-text="testMessage"></div>
                <button @click="testMessage = 'AlpineJS click event works!'" 
                        class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">
                    Test AlpineJS Click
                </button>
                <button @click="showCreateModal = true" 
                        class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg">
                    Test Modal Open
                </button>
                <div x-show="showCreateModal" class="text-green-400">Modal is open! <button @click="showCreateModal = false" class="text-white underline">Close</button></div>
            </div>
        </div>

        <!-- Button Tests -->
        <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 mb-6">
            <h2 class="text-xl font-bold text-white mb-4">ðŸŽ¯ Button Tests</h2>
            <div class="space-y-4">
                
                <!-- Test buttons without role check -->
                <div>
                    <h3 class="text-white font-semibold mb-2">Test buttons (no role check):</h3>
                    <div class="space-x-4">
                        <button @click="showCreateModal = true"
                                class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl font-bold">
                            Create Session (No Role Check)
                        </button>
                        <button @click="showJoinModal = true"
                                class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-6 py-3 rounded-xl font-bold">
                            Join Session (No Role Check)
                        </button>
                    </div>
                </div>
                
                <!-- Test buttons with role check -->
                <div>
                    <h3 class="text-white font-semibold mb-2">Test buttons (with role check):</h3>
                    <div class="space-x-4">
                        {% if user and user.role == 'lecturer' %}
                        <button @click="showCreateModal = true"
                                class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl font-bold">
                            Create Session (Lecturer Only)
                        </button>
                        {% else %}
                        <div class="bg-red-500/20 text-red-300 px-4 py-2 rounded-lg inline-block">
                            Create Session button hidden - not a lecturer
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Create Session Modal -->
        <div x-show="showCreateModal" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             class="fixed inset-0 z-50 overflow-y-auto"
             style="display: none;">
            <div class="flex items-center justify-center min-h-screen px-4">
                <div class="fixed inset-0 bg-black opacity-50" @click="showCreateModal = false"></div>
                
                <div class="bg-white max-w-md w-full mx-auto relative z-10 rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-800">Create Live Session</h3>
                        <button @click="showCreateModal = false" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form id="createSessionForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Session Name</label>
                            <input type="text" name="session_name" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500"
                                   placeholder="Enter session name">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                            <textarea name="description" rows="3"
                                      class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500"
                                      placeholder="Brief description"></textarea>
                        </div>
                        
                        <button type="submit"
                                class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 px-4 rounded-xl font-bold">
                            Create & Start Session
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Join Session Modal -->
        <div x-show="showJoinModal" 
             x-transition:enter="transition ease-out duration-300"
             class="fixed inset-0 z-50 overflow-y-auto"
             style="display: none;">
            <div class="flex items-center justify-center min-h-screen px-4">
                <div class="fixed inset-0 bg-black opacity-50" @click="showJoinModal = false"></div>
                
                <div class="bg-white max-w-md w-full mx-auto relative z-10 rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-800">Join Session</h3>
                        <button @click="showJoinModal = false" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Room ID</label>
                            <input type="text" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500"
                                   placeholder="Enter Room ID">
                        </div>
                        
                        <button class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-3 px-4 rounded-xl font-bold">
                            Join Session
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Debug page loaded');
    console.log('User role check:', {{ 'true' if user and user.role == 'lecturer' else 'false' }});
    
    // Test form handler
    const createForm = document.getElementById('createSessionForm');
    if (createForm) {
        createForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('Form submitted');
            alert('Form submission intercepted for testing');
        });
    }
});
</script>

{% endblock %}