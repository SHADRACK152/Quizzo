{% extends "base.html" %}

{% block title %}Create Account - QUIZZO{% endblock %}

{% block body %}
<div class="min-h-screen bg-gradient-to-br from-accent-50 via-white to-primary-50 flex items-center justify-center p-4">
    <!-- Background Elements -->
    <div class="absolute inset-0 overflow-hidden">
        <div class="absolute -top-40 -left-40 w-96 h-96 bg-accent-200 rounded-full mix-blend-multiply filter blur-xl opacity-60 floating-element"></div>
        <div class="absolute -bottom-40 -right-40 w-96 h-96 bg-primary-200 rounded-full mix-blend-multiply filter blur-xl opacity-60 floating-element" style="animation-delay: 3s;"></div>
        <div class="absolute top-1/3 right-1/4 w-80 h-80 bg-success-200 rounded-full mix-blend-multiply filter blur-xl opacity-60 floating-element" style="animation-delay: 6s;"></div>
    </div>

    <!-- Main Container -->
    <div class="relative w-full max-w-7xl mx-auto grid lg:grid-cols-2 gap-12 items-center">
        
        <!-- Left Side - Form -->
        <div class="w-full max-w-lg mx-auto lg:mx-0 order-2 lg:order-1 animate-slide-up">
            <!-- Form Container -->
            <div class="modern-card bg-white/90 backdrop-blur-xl border-white/60 shadow-xl-colored">
                <!-- Header -->
                <div class="text-center mb-8">
                    <div class="inline-flex lg:hidden items-center space-x-3 mb-6">
                        <div class="w-12 h-12 bg-gradient-to-r from-accent-500 to-primary-500 rounded-xl flex items-center justify-center">
                            <i class="fas fa-graduation-cap text-white text-lg"></i>
                        </div>
                        <h1 class="text-2xl font-bold gradient-text font-display">QUIZZO</h1>
                    </div>
                    
                    <h2 class="text-2xl font-bold text-secondary-900 mb-2">Join the Future of Education</h2>
                    <p class="text-secondary-600">Create your account and start your journey with QUIZZO</p>
                </div>

                <!-- Progress Indicator -->
                <div class="mb-8">
                    <div class="flex items-center justify-between text-sm font-medium text-secondary-500 mb-2">
                        <span>Account Setup</span>
                        <span id="progress-text">Step 1 of 2</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 50%"></div>
                    </div>
                </div>

                <!-- Signup Form -->
                <form method="post" action="{{ url_for('signup') }}" class="space-y-6" id="signup-form">
                    <!-- Step 1: Basic Information -->
                    <div id="step-1" class="space-y-6">
                        <!-- Username Field -->
                        <div class="space-y-2">
                            <label for="username" class="block text-sm font-semibold text-secondary-700">
                                <i class="fas fa-user mr-2 text-secondary-400"></i>Username
                            </label>
                            <input type="text" 
                                   name="username" 
                                   id="username" 
                                   required
                                   placeholder="Choose a unique username"
                                   class="modern-input focus-ring"
                                   onblur="checkUsername()">
                            <p class="text-xs text-secondary-500">
                                <i class="fas fa-info-circle mr-1"></i>
                                This will be your unique identifier on QUIZZO
                            </p>
                        </div>

                        <!-- Email Field -->
                        <div class="space-y-2">
                            <label for="email" class="block text-sm font-semibold text-secondary-700">
                                <i class="fas fa-envelope mr-2 text-secondary-400"></i>Email Address
                            </label>
                            <input type="email" 
                                   name="email" 
                                   id="email" 
                                   required
                                   placeholder="Enter your email address"
                                   class="modern-input focus-ring">
                            <p class="text-xs text-secondary-500">
                                <i class="fas fa-shield-alt mr-1"></i>
                                We'll never share your email with anyone
                            </p>
                        </div>

                        <!-- User Type Selection -->
                        <div class="space-y-3">
                            <label class="block text-sm font-semibold text-secondary-700">
                                <i class="fas fa-users mr-2 text-secondary-400"></i>I am a...
                            </label>
                            <div class="grid grid-cols-2 gap-3">
                                <label class="relative cursor-pointer">
                                    <input type="radio" name="role" value="student" required class="sr-only peer">
                                    <div class="p-4 border-2 border-secondary-200 rounded-xl peer-checked:border-primary-500 peer-checked:bg-primary-50 transition-all hover:border-secondary-300">
                                        <div class="text-center">
                                            <i class="fas fa-user-graduate text-2xl text-secondary-400 peer-checked:text-primary-600 mb-2"></i>
                                            <h3 class="font-semibold text-secondary-700">Student</h3>
                                            <p class="text-xs text-secondary-500">Take exams and track progress</p>
                                        </div>
                                    </div>
                                </label>
                                
                                <label class="relative cursor-pointer">
                                    <input type="radio" name="role" value="lecturer" required class="sr-only peer">
                                    <div class="p-4 border-2 border-secondary-200 rounded-xl peer-checked:border-primary-500 peer-checked:bg-primary-50 transition-all hover:border-secondary-300">
                                        <div class="text-center">
                                            <i class="fas fa-chalkboard-teacher text-2xl text-secondary-400 peer-checked:text-primary-600 mb-2"></i>
                                            <h3 class="font-semibold text-secondary-700">Lecturer</h3>
                                            <p class="text-xs text-secondary-500">Create and manage exams</p>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <button type="button" onclick="nextStep()" class="w-full btn-primary text-lg font-semibold py-4">
                            <span>Continue</span>
                            <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>

                    <!-- Step 2: Security -->
                    <div id="step-2" class="space-y-6 hidden">
                        <!-- Password Field -->
                        <div class="space-y-2">
                            <label for="password" class="block text-sm font-semibold text-secondary-700">
                                <i class="fas fa-lock mr-2 text-secondary-400"></i>Password
                            </label>
                            <div class="relative">
                                <input type="password" 
                                       name="password" 
                                       id="password" 
                                       required
                                       placeholder="Create a strong password"
                                       class="modern-input focus-ring pr-12"
                                       onkeyup="checkPassword()">
                                <button type="button" 
                                        class="absolute right-3 top-1/2 transform -translate-y-1/2 text-secondary-400 hover:text-secondary-600"
                                        onclick="togglePassword('password')">
                                    <i class="fas fa-eye" id="password-toggle"></i>
                                </button>
                            </div>
                            <!-- Password Strength Indicator -->
                            <div class="space-y-2">
                                <div class="flex space-x-1">
                                    <div class="h-1 flex-1 bg-secondary-200 rounded-full">
                                        <div id="strength-bar" class="h-1 bg-danger-500 rounded-full transition-all" style="width: 0%"></div>
                                    </div>
                                </div>
                                <p id="strength-text" class="text-xs text-secondary-500">Password strength: Weak</p>
                            </div>
                        </div>

                        <!-- Confirm Password Field -->
                        <div class="space-y-2">
                            <label for="confirm_password" class="block text-sm font-semibold text-secondary-700">
                                <i class="fas fa-lock mr-2 text-secondary-400"></i>Confirm Password
                            </label>
                            <div class="relative">
                                <input type="password" 
                                       name="confirm_password" 
                                       id="confirm_password" 
                                       required
                                       placeholder="Confirm your password"
                                       class="modern-input focus-ring pr-12"
                                       onkeyup="checkPasswordMatch()">
                                <button type="button" 
                                        class="absolute right-3 top-1/2 transform -translate-y-1/2 text-secondary-400 hover:text-secondary-600"
                                        onclick="togglePassword('confirm_password')">
                                    <i class="fas fa-eye" id="confirm-password-toggle"></i>
                                </button>
                            </div>
                            <p id="password-match" class="text-xs"></p>
                        </div>

                        <!-- Terms Agreement -->
                        <div class="space-y-4">
                            <label class="flex items-start space-x-3 cursor-pointer">
                                <input type="checkbox" 
                                       name="terms" 
                                       required 
                                       class="mt-1 w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500 focus:ring-2">
                                <span class="text-sm text-secondary-600">
                                    I agree to the 
                                    <a href="#" class="font-semibold text-primary-600 hover:text-primary-500">Terms of Service</a> 
                                    and 
                                    <a href="#" class="font-semibold text-primary-600 hover:text-primary-500">Privacy Policy</a>
                                </span>
                            </label>
                            
                            <label class="flex items-start space-x-3 cursor-pointer">
                                <input type="checkbox" 
                                       name="newsletter" 
                                       class="mt-1 w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500 focus:ring-2">
                                <span class="text-sm text-secondary-600">
                                    Send me updates about new features and educational content
                                </span>
                            </label>
                        </div>

                        <!-- Error Message -->
                        {% if error %}
                        <div class="notification error animate-scale-in">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-circle mr-3"></i>
                                <span>{{ error }}</span>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Navigation Buttons -->
                        <div class="flex space-x-4">
                            <button type="button" onclick="prevStep()" class="flex-1 btn-secondary py-4">
                                <i class="fas fa-arrow-left mr-2"></i>
                                Back
                            </button>
                            <button type="submit" class="flex-1 btn-primary py-4 font-semibold">
                                <i class="fas fa-user-plus mr-2"></i>
                                Create Account
                            </button>
                        </div>
                    </div>
                </form>

                <!-- Sign In Link -->
                <div class="mt-8 text-center">
                    <p class="text-secondary-600">Already have an account?</p>
                    <a href="{{ url_for('login') }}" 
                       class="inline-flex items-center mt-2 text-primary-600 hover:text-primary-500 font-semibold transition-colors">
                        <i class="fas fa-sign-in-alt mr-2"></i>
                        Sign In to QUIZZO
                    </a>
                </div>
            </div>
        </div>

        <!-- Right Side - Benefits & Features -->
        <div class="hidden lg:block space-y-8 order-1 lg:order-2 animate-fade-in">
            <!-- Main Heading -->
            <div class="text-center lg:text-left">
                <div class="inline-flex items-center space-x-4 mb-6">
                    <div class="w-16 h-16 bg-gradient-to-r from-accent-500 to-primary-500 rounded-2xl flex items-center justify-center shadow-xl">
                        <i class="fas fa-graduation-cap text-white text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-4xl font-bold gradient-text font-display">QUIZZO</h1>
                        <p class="text-secondary-500 font-medium">Revolutionizing Education</p>
                    </div>
                </div>
                
                <h2 class="text-3xl lg:text-4xl font-bold text-secondary-900 mb-4 leading-tight">
                    Join the <span class="gradient-text">Educational Revolution</span>
                </h2>
                <p class="text-lg text-secondary-600 mb-8 leading-relaxed">
                    Experience the future of assessment with our cutting-edge AI technology, 
                    comprehensive analytics, and user-friendly interface designed for modern education.
                </p>
            </div>

            <!-- Key Benefits -->
            <div class="space-y-6">
                <div class="flex items-start space-x-4 p-6 bg-white/70 backdrop-blur-sm rounded-2xl border border-white/50 hover-lift">
                    <div class="w-12 h-12 bg-primary-100 rounded-xl flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-brain text-primary-600 text-lg"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-secondary-900 text-lg mb-2">AI-Powered Intelligence</h3>
                        <p class="text-secondary-600">
                            Advanced AI algorithms provide real-time proctoring, automatic grading, 
                            and intelligent question generation for enhanced assessment quality.
                        </p>
                    </div>
                </div>
                
                <div class="flex items-start space-x-4 p-6 bg-white/70 backdrop-blur-sm rounded-2xl border border-white/50 hover-lift">
                    <div class="w-12 h-12 bg-success-100 rounded-xl flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-chart-analytics text-success-600 text-lg"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-secondary-900 text-lg mb-2">Advanced Analytics</h3>
                        <p class="text-secondary-600">
                            Comprehensive performance insights, progress tracking, and detailed 
                            reports help educators make data-driven decisions.
                        </p>
                    </div>
                </div>
                
                <div class="flex items-start space-x-4 p-6 bg-white/70 backdrop-blur-sm rounded-2xl border border-white/50 hover-lift">
                    <div class="w-12 h-12 bg-accent-100 rounded-xl flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-shield-check text-accent-600 text-lg"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-secondary-900 text-lg mb-2">Enterprise Security</h3>
                        <p class="text-secondary-600">
                            Bank-level security with end-to-end encryption, secure data storage, 
                            and compliance with international privacy standards.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Statistics -->
            <div class="bg-gradient-to-r from-primary-500 to-accent-500 rounded-2xl p-8 text-white">
                <h3 class="text-xl font-bold mb-6 text-center">Trusted Worldwide</h3>
                <div class="grid grid-cols-3 gap-6 text-center">
                    <div>
                        <div class="text-3xl font-bold mb-1">500K+</div>
                        <div class="text-primary-100 text-sm">Students</div>
                    </div>
                    <div>
                        <div class="text-3xl font-bold mb-1">50K+</div>
                        <div class="text-primary-100 text-sm">Educators</div>
                    </div>
                    <div>
                        <div class="text-3xl font-bold mb-1">1M+</div>
                        <div class="text-primary-100 text-sm">Exams Taken</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script>
    let currentStep = 1;
    
    function nextStep() {
        // Validate current step
        if (currentStep === 1) {
            const username = document.getElementById('username').value.trim();
            const email = document.getElementById('email').value.trim();
            const role = document.querySelector('input[name="role"]:checked');
            
            if (!username || !email || !role) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            // Hide step 1, show step 2
            document.getElementById('step-1').classList.add('hidden');
            document.getElementById('step-2').classList.remove('hidden');
            
            // Update progress
            currentStep = 2;
            updateProgress();
        }
    }
    
    function prevStep() {
        if (currentStep === 2) {
            // Hide step 2, show step 1
            document.getElementById('step-2').classList.add('hidden');
            document.getElementById('step-1').classList.remove('hidden');
            
            // Update progress
            currentStep = 1;
            updateProgress();
        }
    }
    
    function updateProgress() {
        const progressFill = document.getElementById('progress-fill');
        const progressText = document.getElementById('progress-text');
        
        if (currentStep === 1) {
            progressFill.style.width = '50%';
            progressText.textContent = 'Step 1 of 2';
        } else {
            progressFill.style.width = '100%';
            progressText.textContent = 'Step 2 of 2';
        }
    }
    
    function togglePassword(fieldId) {
        const passwordInput = document.getElementById(fieldId);
        const passwordToggle = document.getElementById(fieldId + '-toggle');
        
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            passwordToggle.classList.remove('fa-eye');
            passwordToggle.classList.add('fa-eye-slash');
        } else {
            passwordInput.type = 'password';
            passwordToggle.classList.remove('fa-eye-slash');
            passwordToggle.classList.add('fa-eye');
        }
    }
    
    function checkPassword() {
        const password = document.getElementById('password').value;
        const strengthBar = document.getElementById('strength-bar');
        const strengthText = document.getElementById('strength-text');
        
        let strength = 0;
        let text = 'Very Weak';
        let color = '#ef4444';
        
        if (password.length >= 8) strength += 20;
        if (password.match(/[a-z]/)) strength += 20;
        if (password.match(/[A-Z]/)) strength += 20;
        if (password.match(/[0-9]/)) strength += 20;
        if (password.match(/[^a-zA-Z0-9]/)) strength += 20;
        
        if (strength >= 80) {
            text = 'Very Strong';
            color = '#22c55e';
        } else if (strength >= 60) {
            text = 'Strong';
            color = '#22c55e';
        } else if (strength >= 40) {
            text = 'Medium';
            color = '#f59e0b';
        } else if (strength >= 20) {
            text = 'Weak';
            color = '#f59e0b';
        }
        
        strengthBar.style.width = strength + '%';
        strengthBar.style.backgroundColor = color;
        strengthText.textContent = `Password strength: ${text}`;
        strengthText.style.color = color;
    }
    
    function checkPasswordMatch() {
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm_password').value;
        const matchText = document.getElementById('password-match');
        
        if (confirmPassword === '') {
            matchText.textContent = '';
            return;
        }
        
        if (password === confirmPassword) {
            matchText.textContent = '✓ Passwords match';
            matchText.className = 'text-xs text-success-600';
        } else {
            matchText.textContent = '✗ Passwords do not match';
            matchText.className = 'text-xs text-danger-600';
        }
    }
    
    function checkUsername() {
        const username = document.getElementById('username').value.trim();
        if (username.length < 3) {
            showToast('Username must be at least 3 characters long', 'warning');
        }
    }
    
    // Form submission validation
    function validateForm() {
        const username = document.getElementById('username').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm_password').value;
        const role = document.querySelector('input[name="role"]:checked');
        const terms = document.querySelector('input[name="terms"]:checked');
        
        if (!username || username.length < 3) {
            showToast('Username must be at least 3 characters long', 'error');
            return false;
        }
        
        if (!email || !email.includes('@')) {
            showToast('Please enter a valid email address', 'error');
            return false;
        }
        
        if (!password || password.length < 6) {
            showToast('Password must be at least 6 characters long', 'error');
            return false;
        }
        
        if (password !== confirmPassword) {
            showToast('Passwords do not match', 'error');
            return false;
        }
        
        if (!role) {
            showToast('Please select your role (Student or Lecturer)', 'error');
            return false;
        }
        
        if (!terms) {
            showToast('You must agree to the Terms of Service', 'error');
            return false;
        }
        
        return true;
    }
    
    // Add form submission handler
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('signup-form');
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        
        form.addEventListener('submit', function(e) {
            if (!validateForm()) {
                e.preventDefault();
                return;
            }
            
            // Show loading state
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Creating Account...';
            
            // Re-enable button after 10 seconds as fallback
            setTimeout(() => {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }, 10000);
        });
    });
    
    // Initialize animations
    document.addEventListener('DOMContentLoaded', function() {
        const floatingElements = document.querySelectorAll('.floating-element');
        floatingElements.forEach((element, index) => {
            element.style.animationDelay = `${index * 2}s`;
        });
        
        // Add input validation
        const inputs = document.querySelectorAll('.modern-input');
        inputs.forEach(input => {
            input.addEventListener('blur', function() {
                if (this.value.trim() !== '') {
                    this.classList.add('has-value');
                } else {
                    this.classList.remove('has-value');
                }
            });
        });
    });
</script>

<style>
    .modern-input.has-value {
        border-color: #22c55e;
        background-color: #f0fdf4;
    }
    
    .floating-element:nth-child(1) { animation-duration: 10s; }
    .floating-element:nth-child(2) { animation-duration: 12s; }
    .floating-element:nth-child(3) { animation-duration: 14s; }
    
    input[type="radio"]:checked + div {
        border-color: #0ea5e9 !important;
        background-color: #f0f9ff !important;
    }
    
    input[type="radio"]:checked + div i {
        color: #0ea5e9 !important;
    }
</style>
{% endblock %}
